<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <link rel= "stylesheet" type= "text/css" href= "static/base.css">
    <link rel= "stylesheet" type= "text/css" href= "static/resultado.css">
    <title>Relatório</title>

</head>

<body>

<header>
    <img src="static/logo-unirio.png" alt="Logo da UNIRIO">
</header>

<div class="container">
    <div class="tab-container">
        <div class="tab" onclick="showTab('faltantes')">Obrigatórias</div>
        <div class="tab" onclick="showTab('optativas')">Optativas</div>
        <div class="tab" onclick="showTab('situação')">Situação</div>
    </div>
<section id="faltantes" class="tab-content active">
    <h2>Disciplinas por Período:</h2>

    {% for periodo in relatorio.faltantes.keys() %}
        <h3>{{ periodo }}° período</h3>
        <div>
            <ul>
                {% for materia in relatorio.faltantes[periodo] %}
                    <li class="materia-card tooltip {% if materia.requisitos_ok %}requisito-ok{% else %}requisito-pendente{% endif %}"
                        style="color: {% if materia.requisitos_ok %}blue{% else %}red{% endif %};"
                        onclick="openModal('{{ materia.codigo_disciplina }}', '{{ materia.nome_disciplina }}', '{{ materia.ementa }}', '{{ materia.carga_horaria }}', '{{ relatorio.requisitos[materia.nome_disciplina] | join(', ') }}', {% if not materia.requisitos_ok %}true{% else %}false{% endif %})">
                        <div class="materia-info">
                            <div class="materia-codigo">
                                {{ materia.codigo_disciplina }}
                                {% if not materia.requisitos_ok %}
                                    <i class="fas fa-exclamation-circle" style="color: #EA526F; font-size: 20px;"></i>
                                {% endif %}
                            </div>
                            <div class="materia-nome">{{ materia.nome_disciplina | upper }}</div>
                        </div>
                        <div class="materia-status"></div>
                    </li>
                {% endfor %}

                {% for turma in relatorio.turmas_cursadas %}
                    {% if turma.periodo == periodo %}
                        <li class="materia-card" style="color: green;"
                            onclick="openModal('{{ turma.codigo_disciplina }}', '{{ turma.nome_disciplina }}', '{{ turma.ementa }}', '{{ turma.carga_horaria }}', '{{ turma.requisitos | join(', ') if turma.requisitos else 'Nenhum' }}', false)">
                            <div class="materia-info">
                                <div class="materia-codigo">{{ turma.codigo_disciplina }}</div>
                                <div class="materia-nome">{{ turma.nome_disciplina | upper }}</div>
                            </div>
                            <div class="materia-status"></div>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    {% endfor %}

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modal-title"></h2>
            <p id="modal-ementa"></p>
            <p id="modal-carga-horaria"></p>
            <p id="modal-requisitos"></p>
        </div>
    </div>
</section>




 <section id="optativas" class="tab-content">

    {% if relatorio.optativas_cursadas > 0 %}
        <h2>Optativas Cursadas:</h2>
        <ul>
            {% for optativa in relatorio.lista_optativas_cursadas %}
            <li class="materia-card tooltip optativa-card">
                <div class="materia-info">
                    <div class="materia-codigo">
                        {{ optativa.codigo_disciplina }}
                    </div>
                    <div class="materia-nome">{{ optativa.nome_disciplina | upper }}</div>
                </div>
                <div class="materia-status">
                    <span class="tooltiptext">
                        <strong>Ementa:</strong> {{ optativa.ementa }}<br>
                        <strong>Carga Horária:</strong> {{ optativa.carga_horaria }}h<br>
                    </span>
                </div>
            </li>
            {% endfor %}
        </ul>
     {% endif %}

</section>


     <section id="situação" class="tab-content">
        <h2>Situação:</h2>

        <!-- Gráfico de Barras: Total de Matérias Cursadas vs Faltantes -->
        <h3>Total de Matérias Cursadas vs Faltantes</h3>
        <canvas id="totalMateriasChart"></canvas>

        <!-- Gráfico de Pizza: Optativas Cursadas vs Faltantes -->
        <h3>Optativas Cursadas vs Faltantes</h3>
        <canvas id="optativasChart"></canvas>

        <!-- Gráfico de Linha: Percentual do Curso já Cursado -->
        <h3>Percentual do Curso Cursado</h3>
        <canvas id="percentualDoughnutChart"></canvas>
    </section>


</div>

<script>
    function showTab(tabId) {
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.classList.remove('active');
        });

        const activeTab = document.getElementById(tabId);
        activeTab.classList.add('active');
    }
</script>

<script>

    function openModal(codigo, nome, ementa, carga_horaria, requisitos, requisitos_pendentes) {
    document.getElementById('modal-title').innerText = `${codigo} - ${nome}`;
    document.getElementById('modal-ementa').innerText = `Ementa: ${ementa}`;
    document.getElementById('modal-carga-horaria').innerText = `Carga Horária: ${carga_horaria}h`;
    document.getElementById('modal-requisitos').innerText = `Requisitos: ${requisitos || 'Nenhum'}`;

    // Exibe o modal
    document.getElementById('modal').style.display = 'block';
}

function closeModal() {
    // Esconde o modal
    document.getElementById('modal').style.display = 'none';
}

// Fecha o modal ao clicar fora dele
window.onclick = function(event) {
    if (event.target === document.getElementById('modal')) {
        closeModal();
    }
}

</script>

<script>

    // Gráfico de Barras para Total de Matérias Cursadas vs Faltantes
    const totalMateriasCtx = document.getElementById('totalMateriasChart').getContext('2d');
    const totalMateriasChart = new Chart(totalMateriasCtx, {
        type: 'bar',
        data: {
            labels: ['Cursadas', 'Faltantes'],
            datasets: [{
                label: 'Total de Matérias',
                data: [{{ relatorio.total_cursadas }}, {{ relatorio.total_faltantes }}],
                backgroundColor: ['rgba(255, 0, 0, 0.7)', 'rgba(0, 255, 0, 0.7)'],
                borderColor: ['rgba(255, 0, 0, 1)', 'rgba(0, 255, 0, 1)'],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    // Gráfico de Pizza para Optativas Cursadas vs Faltantes
    const optativasCtx = document.getElementById('optativasChart').getContext('2d');
    const optativasChart = new Chart(optativasCtx, {
        type: 'pie',
        data: {
            labels: ['Optativas Cursadas', 'Optativas Faltantes'],
            datasets: [{
                label: 'Optativas',
                data: [{{ relatorio.optativas_cursadas }}, {{ relatorio.total_optativas - relatorio.optativas_cursadas }}],
                backgroundColor: ['rgba(0, 0, 255, 0.7)', 'rgba(255, 255, 0, 0.7)'],
                borderColor: ['rgba(0, 0, 255, 1)', 'rgba(255, 255, 0, 1)'],
                borderWidth: 1
            }]
        }
    });

 // Gráfico de Doughnut para Percentual do Curso Cursado
    const percentualDoughnutCtx = document.getElementById('percentualDoughnutChart').getContext('2d');
    const percentualDoughnutChart = new Chart(percentualDoughnutCtx, {
        type: 'doughnut',
        data: {
            labels: ['Percentual Cursado', 'Percentual Faltante'],
            datasets: [{
                data: [{{ relatorio.percentual_cursado }}, 100 - {{ relatorio.percentual_cursado }}],
                backgroundColor: ['rgba(0, 123, 255, 0.8)', 'rgba(255, 99, 132, 0.2)'],  // Cores mais vivas
                borderColor: ['rgba(0, 123, 255, 1)', 'rgba(255, 99, 132, 1)'],
                borderWidth: 1
            }]
        },
        options: {
            cutout: '70%',  // Define o espaço no meio para estilo anel
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return tooltipItem.label + ': ' + tooltipItem.raw + '%';
                        }
                    }
                }
            }
        }
    });
</script>


</body>
</html>
